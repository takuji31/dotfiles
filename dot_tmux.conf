# === 基本設定 ===
set -g default-terminal "tmux-256color"
set -ag terminal-overrides ",xterm-256color:RGB"
set -g mode-keys vi
set -g mouse on
set -g base-index 1
setw -g pane-base-index 1
set -g renumber-windows on
set -g history-limit 10000
set -g escape-time 0
set -g focus-events on

# === Prefix (Zellijの Ctrl+d → normalモード に相当) ===
unbind C-b
set -g prefix C-d
bind C-d send-prefix

# === ステータスバー ===
set -g status-interval 1
set -g status-style "bg=colour235,fg=colour248"
set -g status-left "#{?#{==:#{client_key_table},root},,[#[fg=colour214,bold]#{client_key_table}#[default]] }#[fg=colour214,bold][#S] "
set -g status-left-length 40
set -g status-right "#[fg=colour248]#T  %m/%d(%a) %H:%M"
set -g status-right-length 60
setw -g window-status-current-style "bg=colour238,fg=colour214,bold"
setw -g window-status-format " #I:#W "
setw -g window-status-current-format " #I:#W "

# === タイトル ===
set -g set-titles on
set -g set-titles-string "#S:#W - #T"

# === ペインレイアウト ===
setw -g main-pane-width 60%
setw -g main-pane-height 70%

# === Prefixテーブル (Zellijのnormalモード相当) ===
# prefix(C-d)を押した後、以下のキーで各モードに遷移
bind p switch-client -T pane
bind t switch-client -T tab
bind r switch-client -T resize
bind m switch-client -T move
bind s copy-mode
bind o switch-client -T session
bind Escape switch-client -T root
bind Enter switch-client -T root

# === Paneモード ===
# フォーカス移動 (モード維持)
bind -T pane h select-pane -L \; switch-client -T pane
bind -T pane n select-pane -D \; switch-client -T pane
bind -T pane e select-pane -U \; switch-client -T pane
bind -T pane i select-pane -R \; switch-client -T pane
bind -T pane Left select-pane -L \; switch-client -T pane
bind -T pane Down select-pane -D \; switch-client -T pane
bind -T pane Up select-pane -U \; switch-client -T pane
bind -T pane Right select-pane -R \; switch-client -T pane
bind -T pane Tab select-pane -t :.+ \; switch-client -T pane
# ペイン操作 (rootに戻る)
bind -T pane d split-window -v -c "#{pane_current_path}"
bind -T pane r split-window -h -c "#{pane_current_path}"
bind -T pane f resize-pane -Z
bind -T pane x confirm kill-pane
bind -T pane c command-prompt -p "pane title:" "select-pane -T '%%'"
# モード脱出
bind -T pane Escape switch-client -T root
bind -T pane Enter switch-client -T root

# === Tabモード ===
# ウィンドウ移動 (モード維持)
bind -T tab h previous-window \; switch-client -T tab
bind -T tab e previous-window \; switch-client -T tab
bind -T tab Left previous-window \; switch-client -T tab
bind -T tab Up previous-window \; switch-client -T tab
bind -T tab n next-window \; switch-client -T tab
bind -T tab i next-window \; switch-client -T tab
bind -T tab Down next-window \; switch-client -T tab
bind -T tab Right next-window \; switch-client -T tab
bind -T tab Tab last-window \; switch-client -T tab
# ウィンドウ操作 (rootに戻る)
bind -T tab a new-window -c "#{pane_current_path}"
bind -T tab r command-prompt "rename-window '%%'"
bind -T tab x confirm kill-window
# ウィンドウ番号ジャンプ (rootに戻る)
bind -T tab 1 select-window -t :1
bind -T tab 2 select-window -t :2
bind -T tab 3 select-window -t :3
bind -T tab 4 select-window -t :4
bind -T tab 5 select-window -t :5
bind -T tab 6 select-window -t :6
bind -T tab 7 select-window -t :7
bind -T tab 8 select-window -t :8
bind -T tab 9 select-window -t :9
# モード脱出
bind -T tab Escape switch-client -T root
bind -T tab Enter switch-client -T root

# === Resizeモード ===
# 小文字: 3セル移動 (モード維持)
bind -T resize h resize-pane -L 3 \; switch-client -T resize
bind -T resize n resize-pane -D 3 \; switch-client -T resize
bind -T resize e resize-pane -U 3 \; switch-client -T resize
bind -T resize i resize-pane -R 3 \; switch-client -T resize
bind -T resize Left resize-pane -L 3 \; switch-client -T resize
bind -T resize Down resize-pane -D 3 \; switch-client -T resize
bind -T resize Up resize-pane -U 3 \; switch-client -T resize
bind -T resize Right resize-pane -R 3 \; switch-client -T resize
# 大文字: 逆方向に1セル移動 (モード維持)
bind -T resize H resize-pane -R 1 \; switch-client -T resize
bind -T resize N resize-pane -U 1 \; switch-client -T resize
bind -T resize E resize-pane -D 1 \; switch-client -T resize
bind -T resize I resize-pane -L 1 \; switch-client -T resize
# フルスクリーン (rootに戻る)
bind -T resize + resize-pane -Z
bind -T resize = resize-pane -Z
# モード脱出
bind -T resize Escape switch-client -T root
bind -T resize Enter switch-client -T root

# === Moveモード ===
# ペイン入替 (モード維持)
bind -T move h swap-pane -U \; switch-client -T move
bind -T move e swap-pane -U \; switch-client -T move
bind -T move n swap-pane -D \; switch-client -T move
bind -T move i swap-pane -D \; switch-client -T move
bind -T move Tab swap-pane -D \; switch-client -T move
# モード脱出
bind -T move Escape switch-client -T root
bind -T move Enter switch-client -T root

# === Sessionモード ===
bind -T session w choose-tree -Zs
bind -T session d detach
bind -T session Escape switch-client -T root
bind -T session Enter switch-client -T root

# === Altショートカット (モード不要、常時有効) ===
# ウィンドウ移動
bind -n M-h previous-window
bind -n M-i next-window
bind -n M-Tab last-window
# ペイン移動
bind -n M-n select-pane -D
bind -n M-e select-pane -U
bind -n S-Left select-pane -L
bind -n S-Right select-pane -R
# ウィンドウ番号ジャンプ
bind -n M-1 select-window -t :1
bind -n M-2 select-window -t :2
bind -n M-3 select-window -t :3
bind -n M-4 select-window -t :4
bind -n M-5 select-window -t :5
bind -n M-6 select-window -t :6
bind -n M-7 select-window -t :7
bind -n M-8 select-window -t :8
bind -n M-9 select-window -t :9
# 新ペイン (右に分割)
bind -n M-a split-window -h -c "#{pane_current_path}"
# ウィンドウ位置入替
bind -n M-, swap-window -t -1 \; previous-window
bind -n M-. swap-window -t +1 \; next-window
# フルスクリーン切替
bind -n M-+ resize-pane -Z
bind -n M-= resize-pane -Z

# === copy-mode-vi (Colemakナビゲーション) ===
bind -T copy-mode-vi h send -X cursor-left
bind -T copy-mode-vi n send -X cursor-down
bind -T copy-mode-vi e send -X cursor-up
bind -T copy-mode-vi i send -X cursor-right
bind -T copy-mode-vi C-n send -X halfpage-down
bind -T copy-mode-vi C-e send -X halfpage-up

# === その他 ===
bind C-q confirm kill-server
